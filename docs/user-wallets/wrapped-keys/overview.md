import Tabs from '@theme/Tabs';
import TabItem from '@theme/TabItem';

# Overview

Wrapped Keys are private keys that are encrypted and stored using Lit's Wrapped Keys backend service. They can be initialized by [importing](./importing-key.md) or [storing](./storing-wrapped-key-metadata.md) an existing private key, or can be [generated](./generating-wrapped-key.md) within a Lit node's trusted execution environment (TEE), meaning the clear text private key never exists outside of a Lit node's TEE.

Regardless of how the Wrapped Key is initialized, each Wrapped Key is associated with an existing [Programmable Keypair (PKP)](../../sdk/wallets/minting.md) and given a unique ID by Lit.

Using the unique ID and [Session Signatures](../authentication/session-sigs/intro.md) from the PKP the Wrapped Key is associated with, you can leverage the Lit network to generate signatures for arbitrary data and transactions (optionally sending the signed transaction to a network) using your encrypted private key.

## Getting Started

### Installing the SDK

:::info
The minimum version of the Lit SDK that supports Wrapped Keys is `6.3.0`, which will be installed from NPM by default.
:::

<Tabs
defaultValue="npm"
values={[
{label: 'npm', value: 'npm'},
{label: 'yarn', value: 'yarn'},
]}>
<TabItem value="npm">

```bash
npm i @lit-protocol/wrapped-keys
```

</TabItem>

<TabItem value="yarn">

```bash
yarn add @lit-protocol/wrapped-keys
```

</TabItem>
</Tabs>

## How it Works

When generating a new Wrapped Key, or initializing one by importing an existing private key, the Wrapped Keys SDK will derive a PKP's Ethereum address from the PKP Session Signatures you provide along with the request.

The generated or imported private key is then [encrypted](#encrypting-the-private-key) using the Lit network's public BLS key, with [Access Control Conditions](../../sdk/access-control/evm/basic-examples) that only allow the derived PKP Ethereum address to decrypt it. The resulting encryption metadata is then stored in Lit's private Dynamo DB instance to be retrieved when performing other actions of the SDK such as signing messages/transactions.

When you request the Wrapped Keys SDK to sign some data using a specific Wrapped Key, you provide the unique ID generated by Lit when the Wrapped Key was initialized as well as PKP Session Signatures.

The SDK will first make a request to the Wrapped Keys backend service to retrieve the encryption metadata corresponding to the unique ID, and then will execute a specific Lit Action passing the encryption metadata and your PKP Session Signatures as parameters.

The Lit Action will then derive the Ethereum address from the Session Signatures, and attempt to [decrypt](#decrypting-the-private-key) the encryption metadata using the Lit network. If the derived address is authorized to decrypt the data (according the Access Control Conditions set when the private key was encrypted), then the Wrapped Key's underlying private key is decrypted within a single Lit node's Trusted Execution Environment (TEE), available to be used for actions such as signing data/transactions.

After the executing Lit Action is finished, the ephemeral memory of the TEE is wiped, the decrypted plaintext private key ceases to exist, and the signed data/transaction is returned to you.

---

In addition to signing data/transactions, the Wrapped Keys SDK includes other functionality such as:

:::info
To learn more about how each SDK function works as well as how to use them, click on the below links.
:::

- [Generating a Wrapped Key](./generating-wrapped-key.md)
- [Importing a private key as a Wrapped Key](./importing-key.md)
- [Exporting a Wrapped Key](./exporting-wrapped-key.md)
- [Getting Wrapped Key Metadata](./getting-wrapped-key-metadata.md)
- [Storing Wrapped Key Metadata](./storing-wrapped-key-metadata.md)
- [Listing all Wrapped Keys associated with a PKP](./listing-wrapped-keys.md)
- [Signing an arbitrary message/data with a Wrapped Key](./sign-message.md)
  - Useful for non transactional data such as:
    - Creating a digital signature of data to verify it hasn't been tampered with
    - Proving ownership (authenticating) of a specific blockchain address
    - Creating and verifying credentials or attestations in decentralized identity systems
- [Signing a blockchain transaction with a Wrapped Key](./sign-transaction.md)
  - Currently Ethereum and Solana transactions are supported out-of-the-box using the Wrapped Keys SDK, however, you can implement your own custom Wrapped Keys Lit Action to support other transaction types and/or signature schemes. For more information on how to do this, please refer to [this guide](./custom-wrapped-keys.md).

:::info
The Wrapped Keys SDK methods for:

- Exporting a Wrapped Key
- Getting Wrapped Key Metadata
- Signing an arbitrary message with a Wrapped Key
- Signing an Ethereum or Solana transaction with a Wrapped Key

expect a Wrapped Key ID as part of their parameters. This ID is generated for each Wrapped Key by the backend service, and is returned by the SDK methods for:

- Generating a Wrapped Key
- Importing a private key as a Wrapped Key
- Storing Wrapped Key Metadata

You can also obtain the IDs for all the Wrapped Keys associated with a specific PKP by using the SDK's [listEncryptedKeyMetadata](./listing-wrapped-keys.md) method.
:::

### Encrypting the Private Key

Whether you're importing, storing, or generating a new private key, the clear text private key is encrypted using the [encryptString](https://v6-api-doc-lit-js-sdk.vercel.app/functions/encryption_src.encryptString.html) method.

When encrypting data using the Lit network, Access Control Conditions are specified to restrict who is authorized to decrypt the data. For more information on how encryption and decryption works using the Lit network, please go [here](../../sdk/access-control/intro).

The Access Control Conditions used to encrypt the private key are:

```ts
[
    {
        contractAddress: '',
        standardContractType: '',
        chain: CHAIN_ETHEREUM,
        method: '',
        parameters: [':userAddress'],
        returnValueTest: {
        comparator: '=',
        value: pkpAddress,
        },
    },
];
```

where `pkpAddress` is the Ethereum address that's derived from the PKP that was authenticated by the Lit network when the request to import, store, or generate a new Wrapped Key was made. With this condition, the only entity authorized to decrypt a Wrapped Key's underlying private key, is the PKP.

### Decrypting the Private Key

When you submit a request to the Wrapped Keys backend service via one of the SDK methods, you must provide PKP Session Signatures. From these Session Signatures, an Ethereum address corresponding to the PKP can be derived. It's this address that the Lit Action submits as part of its request to the Lit network to decrypt the Wrapped Key.

If the derived Ethereum address from the PKP Session Signatures matches the address used to encrypt the Wrapped Key, then decryption is authorized and the Lit Action is able to collect and combine the decryption shares from the Lit nodes and obtain the plaintext private key.

The plaintext private key only exists within the TEE of a single Lit node that is executing the Lit Action. This is enforced using the [decryptToSingleNode](https://actions-docs.litprotocol.com/#decrypttosinglenode) Lit Action method. This single Lit node executing the Lit Action is then able to use the plaintext private to perform signing operations. After the Lit Action is finished executing, the TEE memory is wiped and the plaintext private key ceases to exist.
